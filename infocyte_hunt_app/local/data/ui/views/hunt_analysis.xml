<form>
  <label>HUNT Analysis</label>
  <description>Used to display and search Infocyte HUNT scan data over time</description>
  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="dash_time_tok" searchWhenChanged="true">
      <label>Time Span</label>
      <default>
        <earliest>-30d@d</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="multiselect" token="dash_scan_tok" searchWhenChanged="false">
      <label>Scan Id</label>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>scanid="</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter> OR </delimiter>
      <fieldForLabel>ScanId</fieldForLabel>
      <fieldForValue>scanid</fieldForValue>
      <search>
        <query>index="infocyte" sourcetype="infocytescan" type=ScanMetadata | eval ScanId=targetlist."-".strftime(_time, "%Y%m%d-%H%M-%S") | sort targetlist, -_time | table ScanId, scanid</query>
        <earliest>$dash_time_tok.earliest$</earliest>
        <latest>$dash_time_tok.latest$</latest>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
    </input>
    <input type="text" token="analytics_search_tok" searchWhenChanged="true">
      <label>Search</label>
      <initialValue>*</initialValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Malicious Volatile Memory Injects</title>
      <table>
        <search>
          <query>index="infocyte" sourcetype= "infocytescan" type=MemoryObject $dash_scan_tok$
| where (threatname="Bad" OR threatname="Suspicious" OR flagname="Verified Bad") AND (flagname!="Verified Good")
| search "*$analytics_search_tok$*"
| eval scant=strptime(scancompletedon, "%Y-%m-%dT%H:%M:%S.%3N"), Scan=targetlist."-".strftime(scant, "%Y%m%d-%H%M")
| sort - Scan, - threatscore
| table Scan, hostname, ip, pid, processname, processpath, size, address, protection, avpositives, synapse, threatscore, threatname
| fieldformat path=replace(path,"^(.{40}).*","\1...")
| fieldformat size=size/1000
| rename avpositives as av</query>
          <earliest>$dash_time_tok.earliest$</earliest>
          <latest>$dash_time_tok.latest$</latest>
        </search>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <format type="number" field="size">
          <option name="precision">0</option>
          <option name="unit">kb</option>
        </format>
        <format type="number" field="synapse">
          <option name="useThousandSeparators">false</option>
        </format>
        <format type="color" field="synapse">
          <colorPalette type="list">[#D93F3C,#F7BC38,#6DB7C6,#65A637]</colorPalette>
          <scale type="threshold">-0.5,0,0.5</scale>
        </format>
        <format type="color" field="threatscore">
          <colorPalette type="list">[#65A637,#6DB7C6,#ED8440,#D93F3C]</colorPalette>
          <scale type="threshold">2,6,8</scale>
        </format>
        <format type="color" field="threatname">
          <colorPalette type="map">{"Bad":#D93F3C,"Blacklist":#555555,"Suspicious":#ED8440,"Unknown":#FFFFFF,"Low Risk":#6DB7C6,"Good":#65A637,"Whitelist":#65A637}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Malicious Active Processes, Modules, &amp; Drivers</title>
      <table>
        <search>
          <query>index="infocyte" sourcetype="infocytescan" (type="Process" OR type="Module" OR type="Driver") $dash_scan_tok$
| where (threatname="Bad" OR threatname="Suspicious" OR flagname="Verified Bad") AND (flagname!="Verified Good")
| search "*$analytics_search_tok$*"
| eval scant=strptime(scancompletedon, "%Y-%m-%dT%H:%M:%S.%3N"), Scan=targetlist."-".strftime(scant, "%Y%m%d-%H%M")
| sort - Scan, - threatscore
| table Scan, hostname, ip, type,  name, path, sha1, size, account, accountpriv, occurrences, avpositives, synapse, threatscore, threatname, flagname
| fieldformat path=replace(path,"^(.{40}).*","\1...")
| fieldformat sha1=replace(sha1,".*(.{10})$","...\1")
| fieldformat size=size/1024
| rename avpositives as av, accountpriv as priv</query>
          <earliest>$dash_time_tok.earliest$</earliest>
          <latest>$dash_time_tok.latest$</latest>
        </search>
        <option name="drilldown">cell</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <format type="number" field="size">
          <option name="precision">0</option>
          <option name="unit">kb</option>
        </format>
        <format type="number" field="synapse">
          <option name="useThousandSeparators">false</option>
        </format>
        <format type="color" field="synapse">
          <colorPalette type="list">[#D93F3C,#F7BC38,#6DB7C6,#65A637]</colorPalette>
          <scale type="threshold">-0.5,0,0.5</scale>
        </format>
        <format type="color" field="threatscore">
          <colorPalette type="list">[#65A637,#6DB7C6,#ED8440,#D93F3C]</colorPalette>
          <scale type="threshold">2,6,8</scale>
        </format>
        <format type="color" field="threatname">
          <colorPalette type="map">{"Bad":#D93F3C,"Blacklist":#555555,"Suspicious":#ED8440,"Unknown":#FFFFFF,"Low Risk":#6DB7C6,"Good":#65A637,"Whitelist":#65A637}</colorPalette>
        </format>
        <format type="color" field="flagname">
          <colorPalette type="map">{"Verified Bad":#D93F3C,"Probably Good":#6DB7C6,"Probably Bad":#ED8440}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Legitimate Tools Audit</title>
      <table>
        <search>
          <query>index="infocyte" sourcetype="infocytescan" type="Process" $dash_scan_tok$ [ | inputlookup legittools | fields + toolname  | rename toolname as search]
| search "*$analytics_search_tok$*"
| eval scant=strptime(scancompletedon, "%Y-%m-%dT%H:%M:%S.%3N"), Scan=targetlist."-".strftime(scant, "%Y%m%d-%H%M")
| sort - Scan, - threatscore
| table Scan, hostname, ip, name, commandline, account, accountpriv</query>
          <earliest>$dash_time_tok.earliest$</earliest>
          <latest>$dash_time_tok.latest$</latest>
        </search>
        <option name="drilldown">cell</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <format type="number" field="size">
          <option name="precision">0</option>
          <option name="unit">kb</option>
        </format>
        <format type="number" field="synapse">
          <option name="useThousandSeparators">false</option>
        </format>
        <format type="color" field="synapse">
          <colorPalette type="list">[#D93F3C,#F7BC38,#6DB7C6,#65A637]</colorPalette>
          <scale type="threshold">-0.5,0,0.5</scale>
        </format>
        <format type="color" field="threatscore">
          <colorPalette type="list">[#65A637,#6DB7C6,#ED8440,#D93F3C]</colorPalette>
          <scale type="threshold">2,6,8</scale>
        </format>
        <format type="color" field="threatname">
          <colorPalette type="map">{"Bad":#D93F3C,"Blacklist":#555555,"Suspicious":#ED8440,"Unknown":#FFFFFF,"Low Risk":#6DB7C6,"Good":#65A637,"Whitelist":#65A637}</colorPalette>
        </format>
        <format type="color" field="flagname">
          <colorPalette type="map">{"Verified Bad":#D93F3C,"Probably Good":#6DB7C6,"Probably Bad":#ED8440}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Malicious Autostart Entries</title>
      <table>
        <search>
          <query>index="infocyte" sourcetype="infocytescan" (type=Autostart) $dash_scan_tok$
  | where (threatname="Bad" OR threatname="Suspicious" OR flagname="Verified Bad") AND (flagname!="Verified Good")
  | search "*$analytics_search_tok$*"
  | eval scant=strptime(scancompletedon, "%Y-%m-%dT%H:%M:%S.%3N"), Scan=targetlist."-".strftime(scant, "%Y%m%d-%H%M")
  | sort - Scan, - threatscore
  | table Scan, hostname, ip, autostarttype, name, sha1, size, regpath, regvalue, occurrences, avpositives, synapse, threatscore, threatname
  | fieldformat regpath=replace(regpath,".*(.{30})$","...\1")
  | fieldformat sha1=replace(sha1,".*(.{16})$","...\1")
  | fieldformat size=size/1024
  | rename avpositives as av</query>
          <earliest>$dash_time_tok.earliest$</earliest>
          <latest>$dash_time_tok.latest$</latest>
        </search>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <format type="number" field="size">
          <option name="precision">0</option>
          <option name="unit">kb</option>
        </format>
        <format type="number" field="synapse">
          <option name="useThousandSeparators">false</option>
        </format>
        <format type="color" field="synapse">
          <colorPalette type="list">[#D93F3C,#F7BC38,#6DB7C6,#65A637]</colorPalette>
          <scale type="threshold">-0.5,0,0.5</scale>
        </format>
        <format type="color" field="threatscore">
          <colorPalette type="list">[#65A637,#6DB7C6,#ED8440,#D93F3C]</colorPalette>
          <scale type="threshold">2,6,8</scale>
        </format>
        <format type="color" field="threatname">
          <colorPalette type="map">{"Bad":#D93F3C,"Blacklist":#555555,"Suspicious":#ED8440,"Unknown":#FFFFFF,"Low Risk":#6DB7C6,"Good":#65A637,"Whitelist":#65A637}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Established Connections</title>
      <table>
        <search>
          <query>index="infocyte" sourcetype="infocytescan" (type=Connection) $dash_scan_tok$
| where localaddr != remoteaddr AND threatscore&gt;0
| search "*$analytics_search_tok$*"
| eval scant=strptime(scancompletedon, "%Y-%m-%dT%H:%M:%S.%3N"), Scan=targetlist."-".strftime(scant, "%Y%m%d-%H%M")
| sort - Scan, - threatscore
| table Scan, hostname, processname, localaddr, localport, remoteaddr, remoteport, protocol, threatscore</query>
          <earliest>$dash_time_tok.earliest$</earliest>
          <latest>$dash_time_tok.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
        <format type="number" field="size">
          <option name="precision">0</option>
          <option name="unit">kb</option>
        </format>
        <format type="number" field="synapse">
          <option name="useThousandSeparators">false</option>
        </format>
        <format type="color" field="synapse">
          <colorPalette type="list">[#D93F3C,#F7BC38,#6DB7C6,#65A637]</colorPalette>
          <scale type="threshold">-0.5,0,0.5</scale>
        </format>
        <format type="color" field="threatscore">
          <colorPalette type="list">[#65A637,#6DB7C6,#ED8440,#D93F3C]</colorPalette>
          <scale type="threshold">2,6,8</scale>
        </format>
        <format type="color" field="threatname">
          <colorPalette type="map">{"Bad":#D93F3C,"Blacklist":#555555,"Suspicious":#ED8440,"Unknown":#FFFFFF,"Low Risk":#6DB7C6,"Good":#65A637,"Whitelist":#65A637}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
</form>